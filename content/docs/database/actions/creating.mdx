---
title: Creating Actions
description: Starting long-running tasks
---

# Creating Actions

Start background actions for long-running operations.

## Background Generation

```typescript
const action = await db.generate({
  type: 'Post',
  count: 100,
  data: { blog: blog.$id },
  mode: 'background',
})

// Returns immediately
action.id      // 'action_abc123'
action.status  // 'pending'
```

## Generation Modes

| Mode | Behavior |
|------|----------|
| `'sync'` | Wait for completion (default) |
| `'background'` | Return immediately, run in background |
| `'batch'` | Queue for batch processing (50% cost savings) |

```typescript
// Sync (default) - blocks until done
const posts = await db.generate({
  type: 'Post',
  count: 5,
  data: { topic: 'AI' },
})

// Background - returns action immediately
const action = await db.generate({
  type: 'Post',
  count: 100,
  data: { topic: 'AI' },
  mode: 'background',
})

// Batch - queued, processed in batches
const action = await db.generate({
  type: 'Post',
  count: 1000,
  data: { topic: 'AI' },
  mode: 'batch',
})
```

## Waiting for Results

```typescript
const action = await db.generate({
  type: 'Post',
  count: 100,
  mode: 'background',
})

// Wait for completion
const posts = await action.result()

// Or with timeout
const posts = await action.result({ timeout: 60000 })
```

## Progress Tracking

```typescript
const action = await db.generate({
  type: 'Post',
  count: 100,
  mode: 'background',
})

// Poll for progress
const checkProgress = setInterval(async () => {
  const status = await db.action.get(action.id)
  console.log(`${status.progress}/${status.total}`)

  if (status.status === 'completed') {
    clearInterval(checkProgress)
    console.log('Done!')
  }
}, 1000)
```

## Action Data

Actions store their configuration:

```typescript
const action = await db.action.get(action.id)

action.id        // unique ID
action.type      // 'generate'
action.status    // 'pending' | 'active' | 'completed' | 'failed'
action.progress  // completed count
action.total     // total count
action.data      // { type: 'Post', count: 100, ... }
action.startedAt // when started
action.completedAt // when finished
action.error     // error if failed
action.results   // partial results
```

## Custom Actions

Create custom action types:

```typescript
const action = await db.action.create({
  type: 'embed-all',
  data: { model: 'bge-m3' },
})

// Process in your code
async function processEmbedAll(action) {
  const posts = await db.Post.list()

  for (let i = 0; i < posts.length; i++) {
    await embedPost(posts[i])

    await db.action.update(action.id, {
      progress: i + 1,
      total: posts.length,
    })
  }

  await db.action.update(action.id, {
    status: 'completed',
  })
}
```

## With Events

Actions emit events:

```typescript
db.events.on('Action.started', (event) => {
  console.log(`Action ${event.data.id} started`)
})

db.events.on('Action.completed', (event) => {
  console.log(`Action ${event.data.id} completed`)
})

db.events.on('Action.failed', (event) => {
  console.error(`Action ${event.data.id} failed:`, event.data.error)
})
```

## Concurrent Limits

Control concurrency:

```typescript
const action = await db.generate({
  type: 'Post',
  count: 1000,
  mode: 'background',
  concurrency: 5,  // max 5 concurrent generations
})
```

## Priority

Set action priority:

```typescript
const action = await db.generate({
  type: 'Post',
  count: 100,
  mode: 'background',
  priority: 'high',  // 'high' | 'normal' | 'low'
})
```

High priority actions run before normal and low priority.
