---
title: Defining Relationships
description: Schema syntax for entity relationships
---

# Defining Relationships

Relationships connect entities together. Define them in your schema with simple syntax.

## Basic Syntax

```typescript
const db = DB({
  Post: {
    title: 'string',
    author: 'Author.posts',     // → Author, Author.posts → Post[]
  },
  Author: {
    name: 'string',
    // posts: Post[] is auto-created
  },
})
```

The `'Author.posts'` syntax means:
- `Post.author` returns an `Author`
- `Author.posts` returns `Post[]`

## One-to-Many

One entity owns many others:

```typescript
// Author owns many Posts
Post: {
  author: 'Author.posts',
}

// Company owns many Employees
Employee: {
  company: 'Company.employees',
}

// Category contains many Products
Product: {
  category: 'Category.products',
}
```

### Creating

```typescript
const author = await db.Author.create({ name: 'Alice' })
const post = await db.Post.create({
  title: 'Hello',
  author: author.$id,
})
```

### Traversing

```typescript
// Forward: Post → Author
const author = await post.author

// Backward: Author → Posts
const posts = await author.posts
```

## Many-to-Many

Both sides have arrays. Use bracket syntax:

```typescript
// Post has many Tags, Tag has many Posts
Post: {
  tags: ['Tag.posts'],
}

// Student has many Courses, Course has many Students
Student: {
  courses: ['Course.students'],
}

// User follows many Users
User: {
  following: ['User.followers'],
}
```

### Creating

```typescript
// Create tags
const ai = await db.Tag.create({ name: 'ai' })
const tutorial = await db.Tag.create({ name: 'tutorial' })

// Create post with tags
const post = await db.Post.create({
  title: 'AI Tutorial',
  tags: [ai.$id, tutorial.$id],
})
```

### Traversing

```typescript
// Post → Tags
const tags = await post.tags  // Tag[]

// Tag → Posts
const posts = await tag.posts  // Post[]
```

## One-to-One

Unique relationship on both sides:

```typescript
User: {
  profile: 'Profile.user',
}

Profile: {
  // user: User is auto-created
  bio: 'string',
  avatar: 'url?',
}
```

### Usage

```typescript
const user = await db.User.create({ email: 'alice@example.com' })
const profile = await db.Profile.create({
  user: user.$id,
  bio: 'Software engineer',
})

// Traverse
const userProfile = await user.profile  // Profile
const profileUser = await profile.user  // User
```

## Self-Referential

Entity relates to itself:

```typescript
// User follows Users
User: {
  following: ['User.followers'],
}

// Comment replies to Comments
Comment: {
  parent: 'Comment.replies',
}

// Category has subcategories
Category: {
  parent: 'Category.children',
}
```

## One-Way References

Reference without backref:

```typescript
Post: {
  createdBy: 'User',     // no backref
  updatedBy: 'User',     // no backref
  author: 'Author.posts' // has backref
}
```

One-way references:
- Don't create a backref on the target
- Useful for audit fields
- Lower overhead

## Multiple Relationships

Same type can have multiple relationships:

```typescript
Issue: {
  reporter: 'User.reportedIssues',
  assignee: 'User.assignedIssues',
  watchers: ['User.watchedIssues'],
}
```

## Named Relationships

Use Nouns for semantic naming:

```typescript
import { defineNoun, nounToSchema } from 'ai-database'

const Post = defineNoun({
  singular: 'post',
  plural: 'posts',
  relationships: {
    author: {
      type: 'Author',
      backref: 'posts',
      description: 'Who wrote this post',
    },
    editor: {
      type: 'Author',
      backref: 'editedPosts',
      description: 'Who edited this post',
    },
  },
})

const db = DB({
  Post: nounToSchema(Post),
})
```

## Optional Relationships

Make relationship optional with `?`:

```typescript
Post: {
  author: 'Author.posts',     // required
  editor: 'Author.edited?',   // optional
}
```

## Relationship Metadata

Relationships with properties:

```typescript
// Team membership with role
const membership = await db.relate({
  type: 'member',
  from: user.$id,
  to: team.$id,
  props: { role: 'lead', joinedAt: new Date() },
})
```

Query by relationship properties:

```typescript
const leads = await db.User.find({
  $rel: {
    type: 'member',
    to: team.$id,
    props: { role: 'lead' },
  },
})
```
