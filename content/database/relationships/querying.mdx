---
title: Querying Relationships
description: Traversing and filtering by relationships
---

# Querying Relationships

Multiple ways to query related data.

## Direct Traversal

Access relationships as properties:

```typescript
const post = await db.Post.get('hello')

// Single relationship
const author = await post.author  // Author

// Array relationship
const tags = await post.tags  // Tag[]
```

## Related Function

Get related entities by relationship name:

```typescript
// Get posts by author
const posts = await db.related(author.$id, 'posts')

// Get author of post
const author = await db.related(post.$id, 'author')
```

## $rel Operator

Filter by relationship in queries:

```typescript
// Posts by specific author
const posts = await db.Post.find({
  $rel: {
    type: 'authored',
    from: author.$id,
  },
})

// Posts by verified authors
const posts = await db.Post.find({
  $rel: {
    type: 'authored',
    from: { type: 'Author', where: { verified: true } },
  },
})
```

### Direction

```typescript
// Outgoing relationship
const posts = await db.Post.find({
  $rel: {
    type: 'authored',
    from: { type: 'Author', where: { name: 'Alice' } },
  },
})

// Incoming relationship
const followers = await db.User.find({
  $rel: {
    type: 'follows',
    to: user.$id,
  },
})
```

## Multi-Hop

Traverse multiple relationships:

```typescript
// Posts by users I follow
const feed = await db.Post.find({
  $rel: {
    type: 'authored',
    from: {
      type: 'User',
      where: {
        $rel: {
          type: 'follows',
          to: currentUser.$id,
        },
      },
    },
  },
})
```

## Counting

Count relationships with `$relCount`:

```typescript
// Popular posts
const popular = await db.Post.find({
  $relCount: {
    type: 'likes',
    to: '$self',
    $gte: 100,
  },
})

// Users with many followers
const influencers = await db.User.find({
  $relCount: {
    type: 'follows',
    to: '$self',
    $gte: 10000,
  },
})
```

## Include Related

Fetch related data in one query:

```typescript
const post = await db.Post.get('hello', {
  include: ['author', 'tags'],
})

// Now author and tags are pre-loaded
post.author  // Already resolved
post.tags    // Already resolved
```

## Pagination

Paginate relationships:

```typescript
const author = await db.Author.get('alice')

// First 10 posts
const posts = await db.Post.find({
  $rel: { type: 'authored', from: author.$id },
  limit: 10,
  offset: 0,
  orderBy: 'createdAt',
  order: 'desc',
})
```

## Relationship Existence

Check if relationship exists:

```typescript
// Posts with at least one tag
const tagged = await db.Post.find({
  $relCount: {
    type: 'tagged',
    to: '$self',
    $gte: 1,
  },
})

// Posts without tags
const untagged = await db.Post.find({
  $relCount: {
    type: 'tagged',
    to: '$self',
    $eq: 0,
  },
})
```

## Relationship Properties

Query by relationship metadata:

```typescript
// Team leads
const leads = await db.User.find({
  $rel: {
    type: 'member',
    to: { type: 'Team' },
    props: { role: 'lead' },
  },
})

// Recent follows
const newFollowers = await db.User.find({
  $rel: {
    type: 'follows',
    to: user.$id,
    props: { createdAt: { $gte: lastWeek } },
  },
})
```

## Edge Queries

Query the Edge collection directly:

```typescript
// All relationships to Author
const edges = await db.Edge.find({ to: 'Author' })
// [{ from: 'Post', name: 'author' }, { from: 'Comment', name: 'author' }]

// All many-to-many relationships
const manyToMany = await db.Edge.find({
  cardinality: 'many-to-many',
})
```

## Performance Tips

### Batch Loads

```typescript
// Instead of N+1 queries
for (const post of posts) {
  const author = await post.author  // N queries
}

// Use include
const posts = await db.Post.list({
  include: ['author'],  // 1 query
})
```

### Limit Depth

```typescript
// Avoid deep traversals
const posts = await db.Post.find({
  $rel: {
    type: 'authored',
    from: {
      type: 'User',
      where: {
        $rel: {
          type: 'works_at',
          to: {
            type: 'Company',
            where: {
              // Too deep - consider denormalizing
            },
          },
        },
      },
    },
  },
})
```

### Index Relationships

High-traffic relationships benefit from indexes. The database automatically indexes relationship fields.
