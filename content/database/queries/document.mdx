---
title: Document-Style Queries
description: MongoDB-like patterns for nested data and arrays
---

# Document-Style Queries

Query nested objects, arrays, and JSON fields with dot notation and array operators.

## Nested Fields

Use dot notation to query nested objects:

```typescript
const sfUsers = await db.User.find({
  'profile.location.city': 'San Francisco',
})

const emailEnabled = await db.User.find({
  'settings.notifications.email': true,
})

const premiumPlans = await db.User.find({
  'subscription.plan': 'premium',
  'subscription.status': 'active',
})
```

### Deep Nesting

```typescript
const specific = await db.Config.find({
  'features.analytics.tracking.enabled': true,
  'features.analytics.tracking.provider': 'google',
})
```

## Array Operators

### Contains

```typescript
// Array contains value
const typescript = await db.Post.find({
  tags: { $contains: 'typescript' },
})

// Contains any of
const webDev = await db.Post.find({
  tags: { $containsAny: ['react', 'vue', 'angular'] },
})

// Contains all of
const fullStack = await db.Post.find({
  tags: { $containsAll: ['frontend', 'backend'] },
})
```

### Array Size

```typescript
// Exact size
const solo = await db.Post.find({
  authors: { $size: 1 },
})

// Size comparison
const collaborative = await db.Post.find({
  authors: { $size: { $gt: 1 } },
})

// Non-empty array
const tagged = await db.Post.find({
  tags: { $size: { $gte: 1 } },
})
```

| Operator | Description | Example |
|----------|-------------|---------|
| `$contains` | Array includes value | `{ tags: { $contains: 'ai' } }` |
| `$containsAny` | Array includes any | `{ tags: { $containsAny: ['a', 'b'] } }` |
| `$containsAll` | Array includes all | `{ tags: { $containsAll: ['a', 'b'] } }` |
| `$size` | Array length | `{ items: { $size: 5 } }` |

## Existence Checks

```typescript
// Field exists
const hasAvatar = await db.User.find({
  avatar: { $exists: true },
})

// Field doesn't exist
const noAvatar = await db.User.find({
  avatar: { $exists: false },
})
```

## Type Checks

```typescript
// Check field type
const hasMetadata = await db.Post.find({
  metadata: { $type: 'object' },
})

const hasCount = await db.Post.find({
  viewCount: { $type: 'number' },
})
```

| Type | Values |
|------|--------|
| `'string'` | String values |
| `'number'` | Numbers (int, float) |
| `'boolean'` | true/false |
| `'object'` | Objects |
| `'array'` | Arrays |
| `'null'` | null |

## String Matching

```typescript
// Starts with
const doctors = await db.User.find({
  name: { $startsWith: 'Dr.' },
})

// Ends with
const corporate = await db.User.find({
  email: { $endsWith: '@company.com' },
})

// Contains substring
const mentions = await db.Post.find({
  content: { $contains: '@alice' },
})

// Regex
const slugs = await db.Post.find({
  slug: { $regex: '^[a-z0-9-]+$' },
})
```

| Operator | Description | Example |
|----------|-------------|---------|
| `$startsWith` | String prefix | `{ name: { $startsWith: 'Dr.' } }` |
| `$endsWith` | String suffix | `{ email: { $endsWith: '@corp.com' } }` |
| `$contains` | Substring match | `{ bio: { $contains: 'engineer' } }` |
| `$regex` | Regular expression | `{ slug: { $regex: '^[a-z]+$' } }` |

## JSON Field Queries

Query JSON/JSONB columns:

```typescript
const db = DB({
  Event: {
    name: 'string',
    payload: 'json',  // JSON field
  }
})

// Query JSON properties
const userEvents = await db.Event.find({
  'payload.userId': 'user_123',
  'payload.action': 'purchase',
})

// Nested JSON
const highValue = await db.Event.find({
  'payload.order.total': { $gte: 1000 },
})
```

## Combining Document Queries

```typescript
const targetUsers = await db.User.find({
  // Nested field
  'profile.verified': true,

  // Array contains
  interests: { $containsAll: ['ai', 'programming'] },

  // String match
  email: { $endsWith: '@gmail.com' },

  // Existence
  avatar: { $exists: true },

  // Type check
  metadata: { $type: 'object' },
})
```

## Real-World Examples

### User Profiles

```typescript
// Find users in tech hubs with complete profiles
const techUsers = await db.User.find({
  'profile.location.city': { $in: ['San Francisco', 'Seattle', 'Austin'] },
  'profile.bio': { $exists: true },
  'profile.avatar': { $exists: true },
  skills: { $containsAny: ['javascript', 'python', 'rust'] },
})
```

### Product Catalog

```typescript
// Products with specific attributes
const laptops = await db.Product.find({
  category: 'electronics',
  'specs.type': 'laptop',
  'specs.ram': { $gte: 16 },
  'specs.storage.type': 'ssd',
  features: { $contains: 'touchscreen' },
})
```

### Content Moderation

```typescript
// Posts needing review
const flagged = await db.Post.find({
  'moderation.flags': { $size: { $gte: 3 } },
  'moderation.reviewed': { $exists: false },
  tags: { $containsAny: ['sensitive', 'reported'] },
})
```

### Analytics

```typescript
// Events with specific payload structure
const purchases = await db.Event.find({
  type: 'purchase',
  'payload.items': { $size: { $gte: 1 } },
  'payload.total': { $gte: 100 },
  'payload.currency': 'USD',
})
```
