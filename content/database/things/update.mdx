---
title: Update
description: Updating existing entities
---

# Update

Update entities with `update` and `upsert`.

## Basic Update

```typescript
await db.Post.update('hello-world', {
  title: 'Updated Title',
})
```

Update merges with existing dataâ€”only specified fields change.

## Return Value

Update returns the full updated entity:

```typescript
const post = await db.Post.update('hello-world', {
  published: true,
  publishedAt: new Date(),
})

// Returns full entity with all fields
post.title       // original title (unchanged)
post.published   // true (updated)
post.publishedAt // Date (updated)
post.updatedAt   // new Date (auto-updated)
```

## Multiple Fields

```typescript
await db.Post.update('hello-world', {
  title: 'New Title',
  content: 'New content...',
  tags: ['updated', 'tags'],
})
```

## Updating Relationships

```typescript
// Change author
await db.Post.update('hello-world', {
  author: newAuthor.$id,
})

// Add to array relationship
const post = await db.Post.get('hello-world')
await db.Post.update('hello-world', {
  tags: [...post.tags, 'new-tag'],
})
```

## Upsert

Create if doesn't exist, update if it does:

```typescript
await db.Post.upsert('hello-world', {
  title: 'Hello World',
  content: 'Content here...',
})

// First call: creates
// Second call: updates
```

## Conditional Updates

Use find + update pattern:

```typescript
// Publish all drafts
const drafts = await db.Post.find({ status: 'draft' })

for (const draft of drafts) {
  await db.Post.update(draft.$id, {
    status: 'published',
    publishedAt: new Date(),
  })
}
```

Or with forEach:

```typescript
await db.Post.forEach(
  { where: { status: 'draft' } },
  async (draft) => {
    await db.Post.update(draft.$id, {
      status: 'published',
    })
  }
)
```

## Events

Update emits a `{Type}.updated` event:

```typescript
await db.Post.update('hello', { title: 'New' })
// Emits: Post.updated { url, data, changes, timestamp }

db.events.on('Post.updated', async (event) => {
  console.log('Changed fields:', event.changes)
})
```

## Artifact Invalidation

When content changes, artifacts are invalidated:

```typescript
await db.Post.update('hello', {
  content: 'New content...',
})

// Embedding artifact is regenerated
// Custom artifacts return null until rebuilt
```

## Optimistic Updates

For UI responsiveness:

```typescript
// Update local state immediately
setPost({ ...post, title: 'New Title' })

// Then persist
await db.Post.update(post.$id, { title: 'New Title' })
```

## Validation

Invalid updates throw errors:

```typescript
// Wrong type
await db.Post.update('hello', { title: 123 })
// Error: Expected string for 'title', got number

// Non-existent entity
await db.Post.update('does-not-exist', { title: 'New' })
// Error: Entity not found
```

## Set (Replace)

Replace entire entity data:

```typescript
await db.set(post.url, {
  title: 'Completely New',
  content: 'All fields replaced',
  // Missing fields are removed
})
```

Unlike `update`, `set` replaces all data rather than merging.
